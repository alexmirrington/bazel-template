name: main

on:
  pull_request: ~
  push:
    branches:
      - main

permissions: {}

jobs:
  main:
    name: main
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash

    steps:
      - name: ğŸ›’ Checkout
        uses: actions/checkout@v4 # v4

      - name: âœ¨ Lint
        uses: trunk-io/trunk-action@f6c5f1b90503c30e02059667dbc247f2257b63c5 # v1

      - name: ğŸ¤– Set up just
        uses: extractions/setup-just@v2
        with:
          just-version: 1.25.2

      - name: ğŸ Set up Bazelisk
        uses: bazelbuild/setup-bazelisk@b39c379c82683a5f25d34f0d062761f62693e0b2 # v3

      - name: ğŸ’¾ Mount Bazel cache
        uses: actions/cache@6849a6489940f00c2f30c0fb92c6274307ccb58a # v4
        with:
          path: ~/.cache/bazel
          key: bazel-cache-${{ hashFiles('.bazelignore', '.bazelrc', '.bazelversion', 'WORKSPACE', 'WORKSPACE.bazel', 'MODULE.bazel', '**/*.bzl' ) }}
          restore-keys: bazel-cache-

      - name: ğŸ”¨ Build
        run: just build

      - name: ğŸ¯ Test
        run: just test

      - name: âœ¨ Verify clean
        run: just verify-clean
